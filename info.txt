GhostFS — Complete Recovery Command Reference (XFS, Btrfs, exFAT)
Generated: 2026-02-02

Overview
--------
This file contains the exact zsh commands you can run to build the project,
detect filesystem types, scan XFS/Btrfs/exFAT images for recoverable files,
recover files, and inspect recovered output. Each command block includes a short
explanation, notes about common options, and recommended usage for debugging.

All 3 filesystems (XFS, Btrfs, exFAT) are fully functional and tested.

Usage conventions
-----------------
- Run commands from the repository root (where `Cargo.toml` sits):
	/Users/anmol/Documents/ghostfs
- The examples assume zsh. Environment variable examples use that shell syntax.
- The CLI binary is provided via `cargo run -p ghostfs-cli -- <args>` so you can
	run the latest code without an explicit install. For release builds, use
	`cargo build --release` and run the produced binary in `target/release/`.

1) Build the project
--------------------
Purpose: compile the Rust workspace so the CLI and libraries are up-to-date.

Command:
```zsh
cargo build
```

Explanation:
- `cargo build` compiles all crates in the workspace using the development profile.
- If you want an optimized executable, use `cargo build --release`.
- Fix compilation errors reported by the compiler before proceeding.

2) Show CLI help and subcommand usage
-------------------------------------
Purpose: see available commands and options.

Commands:
```zsh
cargo run -p ghostfs-cli -- --help
cargo run -p ghostfs-cli -- scan --help
cargo run -p ghostfs-cli -- recover --help
```

Explanation:
- Prints top-level CLI help and help for subcommands `scan` and `recover`.
- Useful to confirm flags like `--confidence`, `--out`, and `--ids`.

3) Detect filesystem type
-------------------------
Purpose: quickly detect the filesystem type of an image (optional sanity check).

Commands:
```zsh
# Detect XFS image
cargo run -p ghostfs-cli -- detect test-data/test-xfs.img
# Output: ✅ Detected: XFS

# Detect Btrfs image
cargo run -p ghostfs-cli -- detect test-data/test-btrfs.img
# Output: ✅ Detected: Btrfs

# Detect exFAT image
cargo run -p ghostfs-cli -- detect test-data/test-exfat.img
# Output: ✅ Detected: exFAT
```

Explanation:
- The `detect` command probes the image superblock(s) and prints the filesystem
	type (xfs, btrfs, exfat). This helps ensure you use the correct --fs flag.

4) Scan images for recoverable files (XFS, Btrfs, exFAT)
--------------------------------------------------------
Purpose: run the scanner to enumerate recoverable and candidate files.

Basic commands:
```zsh
# Scan XFS image (2 files expected)
cargo run -p ghostfs-cli -- scan test-data/test-xfs.img

# Scan Btrfs image (3 files expected)
cargo run -p ghostfs-cli -- scan test-data/test-btrfs.img

# Scan exFAT image (6 files expected)
cargo run -p ghostfs-cli -- scan test-data/test-exfat.img
```

Explanation:
- Runs a full scan using the built-in recovery strategies and prints a session
	summary with session ID, files found, and recoverable count.
- Output includes progress logs and an informative final summary.
- Each filesystem has different recovery strategies optimized for its structure.

Capture output to a log:
```zsh
cargo run -p ghostfs-cli -- scan test-data/test-xfs.img | tee scan-xfs.log
cargo run -p ghostfs-cli -- scan test-data/test-btrfs.img | tee scan-btrfs.log
cargo run -p ghostfs-cli -- scan test-data/test-exfat.img | tee scan-exfat.log
```

Notes:
- If the CLI reports zero files but module logs show found files, inspect the
	runtime logs and confidence threshold (see section 8 below).

5) Verbose / debug logging while scanning
-----------------------------------------
Purpose: show internal tracing for debugging (superblock parsing, signature
matching, confidence calculation).

Commands:
```zsh
# Info-level logs (recommended for normal runs)
RUST_LOG=info cargo run -p ghostfs-cli -- scan test-data/test-xfs.img
RUST_LOG=info cargo run -p ghostfs-cli -- scan test-data/test-btrfs.img
RUST_LOG=info cargo run -p ghostfs-cli -- scan test-data/test-exfat.img

# Debug-level logs (very verbose; use only for troubleshooting)
RUST_LOG=debug cargo run -p ghostfs-cli -- scan test-data/test-xfs.img
RUST_LOG=debug cargo run -p ghostfs-cli -- scan test-data/test-btrfs.img
RUST_LOG=debug cargo run -p ghostfs-cli -- scan test-data/test-exfat.img
```

Explanation:
- `RUST_LOG` controls the Rust `tracing` output level. Use `info` or `debug` to
	see filesystem module logs, confidence scoring, and file merges.
- Each filesystem has specific log messages (XFS: AG scanning, Btrfs: B-tree
	traversal, exFAT: FAT chain parsing).

6) Recover all recoverable files to a directory
----------------------------------------------
Purpose: extract all files that pass the configured confidence threshold.

Commands:
```zsh
# Recover XFS files (expect 2 files)
cargo run -p ghostfs-cli -- recover --out recovered-xfs/ test-data/test-xfs.img

# Recover Btrfs files (expect 3 files)
cargo run -p ghostfs-cli -- recover --out recovered-btrfs/ test-data/test-btrfs.img

# Recover exFAT files (expect 6 files)
cargo run -p ghostfs-cli -- recover --out recovered-exfat/ test-data/test-exfat.img
```

Explanation:
- `--out` specifies the output directory (will be created if missing).
- The CLI will run a scan internally if no prior session is provided, then
	recover files whose confidence score >= the configured threshold.
- Each filesystem uses optimized recovery strategies (XFS: extent-based,
	Btrfs: COW-aware, exFAT: FAT chain reconstruction).

7) Recover specific files by ID
-------------------------------
Purpose: extract one or more specific recovered files by their numeric IDs.

Commands:
```zsh
# Recover specific XFS files (IDs 1 and 2)
cargo run -p ghostfs-cli -- recover --out recovered-xfs/ --ids 1,2 test-data/test-xfs.img

# Recover specific Btrfs files (ID 1 only)
cargo run -p ghostfs-cli -- recover --out recovered-btrfs/ --ids 1 test-data/test-btrfs.img

# Recover specific exFAT files (IDs 1, 3, 5)
cargo run -p ghostfs-cli -- recover --out recovered-exfat/ --ids 1,3,5 test-data/test-exfat.img
```

Explanation:
- File IDs are shown in the scan/recover summary output (e.g. "1 -> recovered_file_1.txt").
- Provide a comma-separated list for multiple IDs.
- IDs are assigned sequentially during the scan phase.

8) Adjust confidence threshold for recovery
-------------------------------------------
Purpose: include lower-confidence matches when recovering (use with caution).

Commands:
```zsh
# XFS: lower threshold to 0.3 for weaker matches
cargo run -p ghostfs-cli -- recover --confidence 0.3 --out recovered-xfs/ test-data/test-xfs.img

# Btrfs: aggressive recovery with 0.2 threshold
cargo run -p ghostfs-cli -- recover --confidence 0.2 --out recovered-btrfs/ test-data/test-btrfs.img

# exFAT: high-confidence only (0.8 threshold)
cargo run -p ghostfs-cli -- recover --confidence 0.8 --out recovered-exfat/ test-data/test-exfat.img
```

Explanation:
- The CLI accepts a float between 0.0 and 1.0 for `--confidence`.
- Default threshold is 0.5 (50% confidence).
- Lowering the threshold increases recovered candidates but raises false positives.
- Higher thresholds ensure better quality but may miss some recoverable files.

9) Inspect recovered files and verify content
--------------------------------------------
Purpose: verify recovered output (file types, content preview, checksums).

Commands:
```zsh
# List recovered files from each filesystem
ls -la recovered-xfs/
ls -la recovered-btrfs/
ls -la recovered-exfat/

# Quick content peek
head -n 40 recovered-xfs/recovered_file_1.txt
head -n 200 recovered-xfs/recovered_file_2.json
head -n 100 recovered-btrfs/recovered_file_1.bin
head -n 50 recovered-exfat/doc1.txt

# Determine file types
file recovered-xfs/*
file recovered-btrfs/*
file recovered-exfat/*

# View raw hex
xxd recovered-xfs/recovered_file_2.json | head
xxd recovered-btrfs/recovered_file_1.bin | head

# Compute sha256 checksums
shasum -a 256 recovered-xfs/*
shasum -a 256 recovered-btrfs/*
shasum -a 256 recovered-exfat/*
```

Explanation:
- `file` detects mime/type heuristics; `head` and `xxd` let you inspect content.
- Compute checksums to compare recovered bytes against reference if you have one.
- Different filesystems preserve different metadata (timestamps, permissions, etc.).

10) Extract the Session ID from a saved scan log
------------------------------------------------
Purpose: find the scan session ID printed by the CLI for tracking.

Command:
```zsh
grep 'Session ID:' scan-xfs.log | awk -F': ' '{print $2}'
grep 'Session ID:' scan-btrfs.log | awk -F': ' '{print $2}'
grep 'Session ID:' scan-exfat.log | awk -F': ' '{print $2}'
```

Explanation:
- The session ID is printed after a successful scan (UUID). The `recover`
	command does not require the session id, but it can be useful for bookkeeping
	and tracking multiple recovery sessions.

11) Complete workflow examples for each filesystem
--------------------------------------------------

=== XFS Recovery Workflow ===
```zsh
# 1. Build project
cargo build

# 2. Detect filesystem
cargo run -p ghostfs-cli -- detect test-data/test-xfs.img

# 3. Scan with logging
RUST_LOG=info cargo run -p ghostfs-cli -- scan test-data/test-xfs.img | tee scan-xfs.log

# 4. Review scan results
grep -E '(Session ID|files found|Recoverable)' scan-xfs.log

# 5. Recover files
cargo run -p ghostfs-cli -- recover --out recovered-xfs/ test-data/test-xfs.img

# 6. Verify recovered files
ls -la recovered-xfs/
file recovered-xfs/*
head -n 20 recovered-xfs/recovered_file_1.txt
```

=== Btrfs Recovery Workflow ===
```zsh
# 1. Build project
cargo build

# 2. Detect filesystem
cargo run -p ghostfs-cli -- detect test-data/test-btrfs.img

# 3. Scan with logging
RUST_LOG=info cargo run -p ghostfs-cli -- scan test-data/test-btrfs.img | tee scan-btrfs.log

# 4. Review scan results
grep -E '(Session ID|files found|Recoverable)' scan-btrfs.log

# 5. Recover files
cargo run -p ghostfs-cli -- recover --out recovered-btrfs/ test-data/test-btrfs.img

# 6. Verify recovered files
ls -la recovered-btrfs/
file recovered-btrfs/*
xxd recovered-btrfs/recovered_file_1.bin | head -n 10
```

=== exFAT Recovery Workflow ===
```zsh
# 1. Build project
cargo build

# 2. Detect filesystem
cargo run -p ghostfs-cli -- detect test-data/test-exfat.img

# 3. Scan with logging
RUST_LOG=info cargo run -p ghostfs-cli -- scan test-data/test-exfat.img | tee scan-exfat.log

# 4. Review scan results
grep -E '(Session ID|files found|Recoverable)' scan-exfat.log

# 5. Recover files (expect 6 files)
cargo run -p ghostfs-cli -- recover --out recovered-exfat/ test-data/test-exfat.img

# 6. Verify recovered files
ls -la recovered-exfat/
file recovered-exfat/*
head -n 20 recovered-exfat/doc1.txt
```

Notes and troubleshooting
-------------------------
- If no files are recovered but logs show found candidates, check the
	confidence threshold. The default is 0.5; use `--confidence` to lower it.
- Use `RUST_LOG=debug` only when necessary—debug output can be very large.
- If the CLI errors during build, fix compiler errors or run `cargo clean`.
- Recovered filenames may be synthetic (e.g. `recovered_file_1.txt`) if
	original metadata was unavailable.

Filesystem-specific notes:
- **XFS**: Uses extent-based recovery, AG scanning, expects 2 test files
- **Btrfs**: COW-aware recovery with B-tree traversal, expects 3 test files  
- **exFAT**: FAT chain reconstruction with UTF-16 support, expects 6 test files

Test image locations:
- XFS: test-data/test-xfs.img
- Btrfs: test-data/test-btrfs.img
- exFAT: test-data/test-exfat.img

Expected recovery results:
- XFS: 2 files (recovered_file_1.txt, recovered_file_2.json)
- Btrfs: 3 files (recovered_file_1.bin, recovered_file_2.data, recovered_file_3.txt)
- exFAT: 6 files (doc1.txt, photo1.jpg, music1.mp3, etc.)

Contact / next steps
--------------------
✅ All 3 filesystems (XFS, Btrfs, exFAT) are fully functional
✅ 35 comprehensive unit tests passing
✅ End-to-end recovery verified with test images

Current development focus:
- Phase 4: Filesystem-specific confidence scoring enhancements
- Advanced metadata extraction and preservation
- Performance optimization for large filesystems

If you'd like, the next steps could include:
- Implement XFS/Btrfs/exFAT confidence scoring improvements
- Add integration tests for edge cases
- Create automated test scripts for all filesystems
- Enhance CLI with progress indicators and better error messages

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
QUICK REFERENCE - Most Common Commands
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Build
cargo build

# Detect filesystem type
cargo run -p ghostfs-cli -- detect test-data/test-xfs.img
cargo run -p ghostfs-cli -- detect test-data/test-btrfs.img
cargo run -p ghostfs-cli -- detect test-data/test-exfat.img

# Scan for recoverable files
cargo run -p ghostfs-cli -- scan test-data/test-xfs.img
cargo run -p ghostfs-cli -- scan test-data/test-btrfs.img
cargo run -p ghostfs-cli -- scan test-data/test-exfat.img

# Recover all files
cargo run -p ghostfs-cli -- recover --out recovered-xfs/ test-data/test-xfs.img
cargo run -p ghostfs-cli -- recover --out recovered-btrfs/ test-data/test-btrfs.img
cargo run -p ghostfs-cli -- recover --out recovered-exfat/ test-data/test-exfat.img

# Run example
cargo run --example basic_scan

# Run all tests
cargo test --package ghostfs-core

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

End of file





cargo run -p ghostfs-cli -- scan test-data/test-xfs.img
cargo run -p ghostfs-cli -- recover --help
cargo run -p ghostfs-cli -- recover --out recovered_test_xfs/ test-data/test-xfs.img